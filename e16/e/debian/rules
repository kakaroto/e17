#!/usr/bin/make -f
# Made with the iad of dh_make, by Craig Small

BUILD_DIR=`pwd`/debian/build
INSTALL_DIR=`pwd`/debian/tmp

#export DH_VERBOSE=1

configure: configure.in
	@echo "--- Making configure script and configuring"
	./autogen.sh

Makefile: configure
	@echo "--- Configuring"
	./configure --disable-upgrade --enable-fsstd=yes --prefix=/usr \
					--bindir=/usr/X11R6/bin

build: Makefile build-stamp
build-stamp:
	@echo "--- Compiling"
	dh_testdir
	$(MAKE)
	touch build-stamp

clean:
	@echo "--- Cleaning"
	dh_testdir
	dh_testroot
	rm -f build-stamp
	rm -rf debian/build
	rm -rf `find . -name '.deps'`

	-$(MAKE) distclean
	dh_clean 

install: build
	@echo "--- Installing"
	dh_testdir
	dh_testroot
	$(MAKE) install DESTDIR=${INSTALL_DIR}
	mkdir -p ${INSTALL_DIR}/usr/doc/enlightenment-cvs-docs

binary-indep: build install \
	enlightenment-cvs-docs \
	enlightenment-cvs-theme \

binary-arch: build install \
	enlightenment-cvs \
	dox-cvs

enlightenment-cvs-docs: install
	@echo "--- Building: $@"
	dh_installdocs		 -p$@ -P$(BUILD_DIR)/$@ src/README AUTHORS FAQ
	dh_installchangelogs -p$@ -P$(BUILD_DIR)/$@ src/ChangeLog
	dh_movefiles		 -p$@ -P$(BUILD_DIR)/$@
	dh_compress		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_fixperms		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_installdeb	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_gencontrol	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_md5sums		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_builddeb		 	 -p$@ -P$(BUILD_DIR)/$@

enlightenment-cvs-theme: install
	@echo "--- Building: $@"
	mkdir -p $(BUILD_DIR)/$@/usr/doc
	cd $(BUILD_DIR)/$@/usr/doc; ln -sf enlightenment-cvs-docs $@
	dh_movefiles		 -p$@ -P$(BUILD_DIR)/$@
	dh_compress		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_fixperms		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_installdeb	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_gencontrol	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_md5sums		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_builddeb		 	 -p$@ -P$(BUILD_DIR)/$@

enlightenment-cvs: install
	@echo "--- Building: $@"
	mkdir -p $(BUILD_DIR)/$@/usr/doc
	cd $(BUILD_DIR)/$@/usr/doc; ln -sf enlightenment-cvs-docs $@
	dh_installmenu  	 -p$@ -P$(BUILD_DIR)/$@
	dh_movefiles 		 -p$@ -P$(BUILD_DIR)/$@
	dh_strip 		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_compress		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_fixperms		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_installdeb	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_undocumented	 	 -p$@ -P$(BUILD_DIR)/$@ enlightenment.1x
	dh_shlibdeps	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_gencontrol	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_md5sums		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_builddeb		 	 -p$@ -P$(BUILD_DIR)/$@

dox-cvs: install
	@echo "--- Building: $@"
	dh_installdocs		 -p$@ -P$(BUILD_DIR)/$@ dox/README \
								debian/README.debian
	dh_installchangelogs -p$@ -P$(BUILD_DIR)/$@ dox/ChangeLog
	dh_movefiles 		 -p$@ -P$(BUILD_DIR)/$@
	dh_strip 		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_compress		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_fixperms		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_installdeb	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_undocumented	 	 -p$@ -P$(BUILD_DIR)/$@ dox.1x
	dh_shlibdeps	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_gencontrol	 	 -p$@ -P$(BUILD_DIR)/$@
	dh_md5sums		 	 -p$@ -P$(BUILD_DIR)/$@
	dh_builddeb		 	 -p$@ -P$(BUILD_DIR)/$@

source diff:                                                                  
	@echo >&2 'source and diff are obsolete - use dpkg-source -b'; false

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary
