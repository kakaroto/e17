dnl Process this file with autoconf to produce a configure script.

AC_INIT(configure.in)
AC_CANONICAL_BUILD
AC_CANONICAL_HOST
AM_INIT_AUTOMAKE(ewl, 0.0.4.004)
AM_CONFIG_HEADER(ewl-config.h)

AC_ISC_POSIX
AC_PROG_CC
AM_PROG_CC_STDC
AC_HEADER_STDC
AC_C_CONST
AM_ENABLE_SHARED
AM_PROG_LIBTOOL
AC_C___ATTRIBUTE__

dnl Check for Solaris or other OS
case "$host" in
     *-sun-*)
        AC_DEFINE(HAVE_SUN, 1, [Support for SunOS/Solaris])
        ;;
     *) ;;
esac

dnl Set PACKAGE_LOCALE_DIR in config.h.
if test "x${prefix}" = "xNONE"; then
  AC_DEFINE_UNQUOTED(PACKAGE_LOCALE_DIR, "${ac_default_prefix}/${DATADIRNAME}/locale", [Locale data directory])
else
  AC_DEFINE_UNQUOTED(PACKAGE_LOCALE_DIR, "${prefix}/${DATADIRNAME}/locale", [Locale data directory])
fi

dnl Set PACKAGE_DATA_DIR in config.h.
if test "x${datadir}" = 'x${prefix}/share'; then
  if test "x${prefix}" = "xNONE"; then
    AC_DEFINE_UNQUOTED(PACKAGE_DATA_DIR, "${ac_default_prefix}/share/${PACKAGE}", [Shared data directory])
  else
    AC_DEFINE_UNQUOTED(PACKAGE_DATA_DIR, "${prefix}/share/${PACKAGE}", [Shared data directory])
  fi
else
  AC_DEFINE_UNQUOTED(PACKAGE_DATA_DIR, "${datadir}/${PACKAGE}", [Shared data directory])
fi

dnl Set PACKAGE_SOURCE_DIR in config.h.
packagesrcdir=`cd $srcdir && pwd`
AC_DEFINE_UNQUOTED(PACKAGE_SOURCE_DIR, "${packagesrcdir}", [Source code directory])

dnl Use -Wall if we have gcc.
changequote(,)dnl
if test "x$GCC" = "xyes"; then
  case " $CFLAGS " in
  *[\ \	]-Wall[\ \	]*) ;;
  *) CFLAGS="$CFLAGS -Wall" ;;
  esac
fi
changequote([,])dnl

EDB_CONFIG="edb-config"
AC_ARG_WITH(edb-config,
[  --with-edb-config=FILE   edb-config script to use (eg /usr/bin/edb-config)],
[
   EDB_CONFIG=$withval
   AC_CHECK_PROG(EDB_CONFIG_IN_PATH, $EDB_CONFIG, yes, no)
   if test $EDB_CONFIG_IN_PATH = no; then
      echo "ERROR:"
      echo "The edb-config development script you specified:"
      echo "$EDB_CONFIG"
      echo "was not found.  Please check the path and make sure "
      echo "the script exists and is executable."
      AC_MSG_ERROR([Fatal Error: no edb-config detected.])
   fi
],
[
  AC_CHECK_PROG(EDB_CONFIG_IN_PATH, $EDB_CONFIG, yes, no)
  if test $EDB_CONFIG_IN_PATH = no; then
    echo "ERROR:"
    echo "The edb-config development script was not found in your execute"
    echo "path. This may mean one of several things"
    echo "1. You may not have installed the edb-devel (or edb-dev)"
    echo "   packages."
    echo "2. You may have edb installed somewhere not covered by your path."
    echo ""
    echo "If this is the case make sure you have the packages installed, AND"
    echo "that the edb-config script is in your execute path (see your"
    echo "shell's manual page on setting the \$PATH environment variable), OR"
    echo "alternatively, specify the script to use with --with-edb-config."
    AC_MSG_ERROR([Fatal Error: no edb-config detected.])
  fi
])

edb_cflags=`$EDB_CONFIG --cflags`
edb_libs=`$EDB_CONFIG --libs`

EVAS_CONFIG="evas-config"
AC_ARG_WITH(evas-config,
[  --with-evas-config=FILE   evas-config script to use (eg /usr/bin/evas-config)],
[
   EVAS_CONFIG=$withval
   AC_CHECK_PROG(EVAS_CONFIG_IN_PATH, $EVAS_CONFIG, yes, no)
   if test $EVAS_CONFIG_IN_PATH = no; then
      echo "ERROR:"
      echo "The evas-config development script you specified:"
      echo "$EVAS_CONFIG"
      echo "was not found.  Please check the path and make sure "
      echo "the script exists and is executable."
      AC_MSG_ERROR([Fatal Error: no evas-config detected.])
   fi
],
[
  AC_CHECK_PROG(EVAS_CONFIG_IN_PATH, $EVAS_CONFIG, yes, no)
  if test $EVAS_CONFIG_IN_PATH = no; then
    echo "ERROR:"
    echo "The evas-config development script was not found in your execute"
    echo "path. This may mean one of several things"
    echo "1. You may not have installed the evas-devel (or evas-dev)"
    echo "   packages."
    echo "2. You may have evas installed somewhere not covered by your path."
    echo ""
    echo "If this is the case make sure you have the packages installed, AND"
    echo "that the evas-config script is in your execute path (see your"
    echo "shell's manual page on setting the \$PATH environment variable), OR"
    echo "alternatively, specify the script to use with --with-evas-config."
    AC_MSG_ERROR([Fatal Error: no evas-config detected.])
  fi
])  

evas_cflags=`$EVAS_CONFIG --cflags`
evas_libs=`$EVAS_CONFIG --libs`

PCFLAGS=$CFLAGS
CFLAGS=$evas_cflags" "$CFLAGS
AC_CHECK_HEADERS(Evas_Engine_Software_X11.h, [], [], [
	#include <Evas.h>
	])

AC_CHECK_HEADERS(Evas_Engine_GL_X11.h, [], [], [
	#include <Evas.h>
	])

AC_CHECK_HEADERS(Evas_Engine_FB.h, [], [], [
	#include <Evas.h>
	])

ECORE_CONFIG="ecore-config"
AC_ARG_WITH(ecore-config,
[  --with-ecore-config=FILE   ecore-config script to use (eg /usr/bin/ecore-config)],
[
   ECORE_CONFIG=$withval
   AC_CHECK_PROG(ECORE_CONFIG_IN_PATH, $ECORE_CONFIG, yes, no)
   if test $ECORE_CONFIG_IN_PATH = no; then
      echo "ERROR:"
      echo "The ecore-config development script you specified:"
      echo "$ECORE_CONFIG"
      echo "was not found.  Please check the path and make sure "
      echo "the script exists and is executable."
      AC_MSG_ERROR([Fatal Error: no ecore-config detected.])
   fi
   ],
[
  AC_CHECK_PROG(ECORE_CONFIG_IN_PATH, $ECORE_CONFIG, yes, no)
  if test $ECORE_CONFIG_IN_PATH = no; then
    echo "ERROR:"
    echo "The ecore-config development script was not found in your execute"
    echo "path. This may mean one of several things"
    echo "1. You may not have installed the ecore-devel (or ecore-dev)"
    echo "   packages."
    echo "2. You may have ecore installed somewhere not covered by your path."
    echo ""
    echo "If this is the case make sure you have the packages installed, AND"
    echo "that the ecore-config script is in your execute path (see your"
    echo "shell's manual page on setting the \$PATH environment variable), OR"
    echo "alternatively, specify the script to use with --with-ecore-config."
    AC_MSG_ERROR([Fatal Error: no ecore-config detected.])
  fi
])

ecore_cflags=`$ECORE_CONFIG --cflags`
ecore_libs=`$ECORE_CONFIG --libs`

CFLAGS=$ecore_cflags" "$CFLAGS
EDJE_CONFIG="edje-config"
AC_ARG_WITH(edje-config,
[  --with-edje-config=FILE   edje-config script to use (eg /usr/bin/edje-config)],
[
   EDJE_CONFIG=$withval
   AC_CHECK_PROG(EDJE_CONFIG_IN_PATH, $EDJE_CONFIG, yes, no)
   if test $EDJE_CONFIG_IN_PATH = no; then
      echo "ERROR:"
      echo "The edje-config development script you specified:"
      echo "$EDJE_CONFIG"
      echo "was not found.  Please check the path and make sure "
      echo "the script exists and is executable."
      AC_MSG_ERROR([Fatal Error: no edje-config detected.])
   fi
   ],
[
  AC_CHECK_PROG(EDJE_CONFIG_IN_PATH, $EDJE_CONFIG, yes, no)
  if test $EDJE_CONFIG_IN_PATH = no; then
    echo "ERROR:"
    echo "The edje-config development script was not found in your execute"
    echo "path. This may mean one of several things"
    echo "1. You may not have installed the edje-devel (or edje-dev)"
    echo "   packages."
    echo "2. You may have edje installed somewhere not covered by your path."
    echo ""
    echo "If this is the case make sure you have the packages installed, AND"
    echo "that the edje-config script is in your execute path (see your"
    echo "shell's manual page on setting the \$PATH environment variable), OR"
    echo "alternatively, specify the script to use with --with-edje-config."
    AC_MSG_ERROR([Fatal Error: no edje-config detected.])
  fi
])

edje_cflags=`$EDJE_CONFIG --cflags`
edje_libs=`$EDJE_CONFIG --libs`

CFLAGS=$edje_cflags" "$CFLAGS
EMOTION_CONFIG="emotion-config"
AC_ARG_WITH(emotion-config,
[  --with-emotion-config=FILE   emotion-config script to use (eg /usr/bin/emotion-config)],
[
   EMOTION_CONFIG=$withval
   AC_CHECK_PROG(EMOTION_CONFIG_IN_PATH, $EMOTION_CONFIG, yes, no)
   if test $EMOTION_CONFIG_IN_PATH = no; then
     echo "No emotion-config detected."
   fi
   ],
[
  AC_CHECK_PROG(EMOTION_CONFIG_IN_PATH, $EMOTION_CONFIG, yes, no)
  if test $EMOTION_CONFIG_IN_PATH = no; then
    echo "No emotion-config detected."
  fi
])

requirements="evas ecore edb edje"

CFLAGS=$emotion_cflags" "$CFLAGS
if test "x$EMOTION_CONFIG_IN_PATH" = "xyes"; then
  AC_CHECK_HEADERS(Emotion.h, [
      SUPPORT_EMOTION=1
      emotion_cflags=`$EMOTION_CONFIG --cflags`
      emotion_libs=`$EMOTION_CONFIG --libs`
      ewl_media_include="#include <ewl_media.h>"
      requirements="$requirements emotion"
    ], [
      SUPPORT_EMOTION=0
    ], [])
else
      SUPPORT_EMOTION=0
fi
AM_CONDITIONAL(BUILD_EMOTION_SUPPORT, test "$SUPPORT_EMOTION" -eq 1)
AC_SUBST(BUILD_EMOTION_SUPPORT_TRUE)
AC_SUBST(BUILD_EMOTION_SUPPORT_FALSE)

CFLAGS=$PCFLAGS

AC_SUBST(edb_cflags)
AC_SUBST(edb_libs)

AC_SUBST(evas_cflags)
AC_SUBST(evas_libs)

AC_SUBST(ecore_cflags)
AC_SUBST(ecore_libs)

AC_SUBST(edje_cflags)
AC_SUBST(edje_libs)

AC_SUBST(emotion_cflags)
AC_SUBST(emotion_libs)
AC_SUBST(ewl_media_include)

AC_SUBST(requirements)

AC_OUTPUT([
Makefile
ewl.pc
ewl-config
src/Makefile
src/bin/Makefile
src/lib/Ewl.h
src/lib/Makefile
tools/Makefile
tools/ewl_edb_ed/Makefile
data/Makefile
data/themes/Makefile
], [
chmod +x ewl-config
]
)
